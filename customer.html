<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <title>RJVC Customer Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{
      box-sizing:border-box;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }
    body{
      margin:0;
      background:#f3f4f6;
      color:#111827;
    }
    h1{
      margin:0 0 12px;
    }
    .page{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .card{
      background:#fff;
      border-radius:18px;
      box-shadow:0 12px 30px rgba(15,23,42,.18);
      padding:22px;
      max-width:480px;
      width:100%;
    }
    label{
      display:block;
      font-size:14px;
      margin-bottom:4px;
    }
    input{
      width:100%;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid #d1d5db;
      font-size:15px;
      outline:none;
    }
    input:focus{
      border-color:#2563eb;
      box-shadow:0 0 0 2px rgba(37,99,235,.25);
    }
    .btn{
      border:none;
      border-radius:999px;
      padding:10px 18px;
      font-size:15px;
      font-weight:600;
      cursor:pointer;
    }
    .btn-primary{
      background:#1d4ed8;
      color:#fff;
    }
    .btn-outline{
      background:#fff;
      border:1px solid #d1d5db;
    }
    .mt-2{margin-top:8px;}
    .mt-3{margin-top:12px;}
    .mt-4{margin-top:16px;}
    .flex{display:flex;align-items:center;}
    .between{justify-content:space-between;}
    .small{font-size:12px;color:#6b7280;}
    .error{color:#b91c1c;font-size:13px;margin-top:6px;}

    .wallet{
      border-radius:16px;
      padding:14px;
      color:#fff;
      margin-top:10px;
    }
    .wallet-comm{
      background:#020617;
    }
    .wallet-bonus{
      background:#14532d;
    }
    .wallet-label{
      font-size:13px;
      opacity:.9;
    }
    .wallet-amount{
      font-size:26px;
      font-weight:700;
    }
  </style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="loginPage" class="page">
  <div class="card">
    <h1>Customer Login</h1>
    <label>Customer Name</label>
    <input id="custName" placeholder="जैसे: Rajesh" />
    <div class="mt-2"></div>
    <label>Password</label>
    <input id="custPass" type="password" placeholder="जैसे: 1234" />
    <button class="btn btn-primary mt-3" style="width:100%;" id="loginBtn">Login</button>
    <div id="loginMsg" class="error" style="display:none;"></div>
    <p class="small mt-2">
      आप इस login से किसी भी customer की ID खोल सकते हैं, अगर उसका नाम और सही password पता हो।
    </p>
  </div>
</div>

<!-- CUSTOMER DASHBOARD -->
<div id="dashboardPage" style="display:none;">
  <div class="page" style="align-items:flex-start;">
    <div class="card" style="max-width:600px;width:100%;">
      <div class="flex between">
        <div>
          <h1 style="font-size:20px;margin-bottom:4px;">Customer Dashboard</h1>
          <div class="small" id="welcomeText"></div>
        </div>
        <button class="btn btn-outline" id="logoutBtn">Logout</button>
      </div>

      <!-- सिर्फ दो wallet, कोई extra message / extra boxes नहीं -->
      <div class="wallet wallet-comm mt-3">
        <div class="wallet-label">COMMISSION WALLET</div>
        <div class="wallet-amount" id="commWalletText">₹0</div>
      </div>

      <div class="wallet wallet-bonus">
        <div class="wallet-label">BONUS WALLET</div>
        <div class="wallet-amount" id="bonusWalletText">₹0</div>
      </div>

    </div>
  </div>
</div>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>

<script>
  // वही Firebase config जो index / admin में है
  const firebaseConfig = {
    apiKey: "AIzaSyBDw_FQyDzWZLJORFtOwZqrFRfeS5tOFSw",
    authDomain: "rjvc-plan.firebaseapp.com",
    projectId: "rjvc-plan",
    storageBucket: "rjvc-plan.firebasestorage.app",
    messagingSenderId: "265431528728",
    appId: "1:265431528728:web:c3dc4b8e8f3ae4469a1a6d",
    measurementId: "G-1Y7PN96H93"
  };

  firebase.initializeApp(firebaseConfig);
  try { firebase.analytics(); } catch(e){}

  const db = firebase.firestore();
  const usersCol = db.collection("Users");

  const loginPage   = document.getElementById("loginPage");
  const dashboard   = document.getElementById("dashboardPage");
  const loginBtn    = document.getElementById("loginBtn");
  const logoutBtn   = document.getElementById("logoutBtn");
  const loginMsg    = document.getElementById("loginMsg");

  const welcomeText    = document.getElementById("welcomeText");
  const commWalletText = document.getElementById("commWalletText");
  const bonusWalletText= document.getElementById("bonusWalletText");

  let currentUserId = null;
  let currentUnsub  = null;

  function formatRupees(x){
    return "₹" + (x || 0);
  }

  // LOGIN
  loginBtn.addEventListener("click", async ()=>{
    const name = document.getElementById("custName").value.trim();
    const pass = document.getElementById("custPass").value.trim();
    loginMsg.style.display = "none";

    if(!name || !pass){
      loginMsg.textContent = "नाम और पासवर्ड दोनों भरें।";
      loginMsg.style.display = "block";
      return;
    }

    try{
      const snap = await usersCol
        .where("name","==",name)
        .where("password","==",pass)
        .limit(1)
        .get();

      if(snap.empty){
        loginMsg.textContent = "गलत नाम या पासवर्ड!";
        loginMsg.style.display = "block";
        return;
      }

      const doc = snap.docs[0];
      subscribeCustomer(doc.id);
    }catch(err){
      loginMsg.textContent = "Login error: " + err.message;
      loginMsg.style.display = "block";
    }
  });

  function subscribeCustomer(docId){
    if(currentUnsub) currentUnsub();
    currentUserId = docId;

    currentUnsub = usersCol.doc(docId).onSnapshot(snap=>{
      if(!snap.exists) return;
      const d = snap.data();

      const name   = d.name || "";
      const comm   = d.commissionWallet || 0;
      const bonus  = d.bonusWallet || 0;

      welcomeText.textContent     = "स्वागत है, " + name + " जी";
      commWalletText.textContent  = formatRupees(comm);
      bonusWalletText.textContent = formatRupees(bonus);

      loginPage.style.display = "none";
      dashboard.style.display = "block";
    });
  }

  // LOGOUT
  logoutBtn.addEventListener("click", ()=>{
    if(currentUnsub) currentUnsub();
    currentUnsub = null;
    currentUserId = null;

    document.getElementById("custName").value = "";
    document.getElementById("custPass").value = "";
    dashboard.style.display = "none";
    loginPage.style.display = "flex";
  });
</script>

</body>
</html>
