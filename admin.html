<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>RJVC Binary Tree Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- ===== CSS ===== -->
<style>
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:#020617;color:#e5e7eb}
.wrap{max-width:1200px;margin:auto;padding:14px}
h2{margin-top:0}
.small{font-size:13px;color:#94a3b8}

.btn{padding:8px 14px;border-radius:999px;border:none;font-weight:700;cursor:pointer}
.btn-primary{background:#2563eb;color:#fff}
.btn-secondary{background:#e5e7eb;color:#111827}

.card{
  background:#0b1320;
  border-radius:14px;
  padding:16px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
th,td{
  padding:8px;
  border-bottom:1px solid #1f2937;
  text-align:center;
}
th{background:#020617}

canvas{max-width:100%}
</style>
</head>

<body>

<!-- ================= LOGIN ================= -->
<div id="loginPage" class="wrap">
  <div class="card" style="max-width:400px;margin:60px auto;">
    <h2 class="center">Admin Login</h2>
    <input id="adminId" placeholder="admin" style="width:100%;padding:10px;margin-top:8px">
    <input id="adminPass" type="password" placeholder="1234" style="width:100%;padding:10px;margin-top:8px">
    <button class="btn btn-primary" style="width:100%;margin-top:12px" onclick="login()">Login</button>
    <div id="loginError" class="small" style="color:#f87171;display:none">Wrong login</div>
  </div>
</div>

<!-- ================= ADMIN ================= -->
<div id="adminPage" style="display:none">

<div class="wrap">
  <h2>Binary Tree Admin (Firebase)</h2>

  <!-- ===== ADD PART-1 : INFO + TREE BUTTON ===== -->
  <div class="card" style="margin-bottom:12px;">
    üëâ Customer list, ‚Çπ20 cycle, calculation ‡§∏‡§¨ ‡§™‡§π‡§≤‡•á ‡§ú‡•à‡§∏‡§æ ‡§π‡•à  
    <br><br>
    üëâ Heavy Binary Tree ‡§Ö‡§¨ ‡§Ö‡§≤‡§ó page ‡§Æ‡•á‡§Ç ‡§ñ‡•Å‡§≤‡•á‡§ó‡§æ
    <br><br>
    <button class="btn btn-primary" onclick="window.location.href='tree.html'">
      Tree Full Screen
    </button>
  </div>
  <!-- ===== ADD PART-1 END ===== -->

  <div class="small">
    ‡§π‡§∞ ID ‡§ú‡§¨ ‚Çπ20 ‡§¶‡•á‡§§‡•Ä ‡§π‡•à ‚Üí 1 cycle <br>
    Binary payout levels auto calculate ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç
  </div>
  <button class="btn btn-secondary" onclick="logout()">Logout</button>
</div>

<!-- ===== CREATE ROOT ===== -->
<div class="wrap">
  <div class="card">
    <h3>‡§®‡§Ø‡§æ Customer (Root)</h3>
    <input id="rootName" placeholder="Name" style="width:100%;padding:8px">
    <input id="rootPass" placeholder="Password" style="width:100%;padding:8px;margin-top:8px">
    <button class="btn btn-primary" style="margin-top:10px" onclick="createRoot()">Add Root</button>
  </div>
</div>

<!-- ===== COMPANY REPORT ===== -->
<div class="wrap">
  <h2>Company Business Report</h2>

  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px">
    <div class="card">
      <div class="small">Total Business Income</div>
      <h2 id="totalBusiness">‚Çπ0</h2>
    </div>
    <div class="card">
      <div class="small">Total Binary Payout</div>
      <h2 id="totalPayout">‚Çπ0</h2>
    </div>
    <div class="card">
      <div class="small">Company Profit</div>
      <h2 id="companyProfit">‚Çπ0</h2>
    </div>
  </div>

  <canvas id="businessChart" height="160" style="margin-top:20px"></canvas>
</div>

<!-- ===== ADD PART-2 : WITHDRAWAL APPROVAL ===== -->
<div class="wrap">
  <div class="card">
    <h2>Withdrawal Approval (Admin)</h2>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="withdrawList">
        <tr><td colspan="4">No Requests</td></tr>
      </tbody>
    </table>
  </div>
</div>
<!-- ===== PART-2 END ===== -->

<!-- ===== ADD PART-3 : TRANSFER APPROVAL ===== -->
<div class="wrap">
  <div class="card">
    <h2>Name to Name Transfer (Admin Approval)</h2>
    <table>
      <thead>
        <tr>
          <th>From</th>
          <th>To</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="transferList">
        <tr><td colspan="5">No Requests</td></tr>
      </tbody>
    </table>
  </div>
</div>
<!-- ===== PART-3 END ===== -->

<!-- ===== CUSTOMER LIST ===== -->
<div class="wrap">
  <h2>Customer List</h2>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Total Members</th>
        <th>L / R</th>
        <th>Pairs</th>
        <th>Level</th>
      </tr>
    </thead>
    <tbody id="customerTable"></tbody>
  </table>
</div>

</div>

<!-- ===== LIBRARIES ===== -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey: "AIzaSyBDw_FQyDzWZLJORFtOwZqrFRfeS5tOFSw",
  authDomain: "rjvc-plan.firebaseapp.com",
  projectId: "rjvc-plan"
});

const db = firebase.firestore();
const treeCol = db.collection("TreeNodes");

/* ===== ADD PART-2 & PART-3 FIRESTORE ===== */
const withdrawCol = db.collection("WithdrawRequests");
const transferCol = db.collection("TransferRequests");

/* ================= LOGIN ================= */
function login(){
  if(adminId.value==="admin" && adminPass.value==="1234"){
    loginPage.style.display="none";
    adminPage.style.display="block";
    loadData();
    loadWithdrawals();
    loadTransfers();
  }else{
    loginError.style.display="block";
  }
}
function logout(){ location.reload(); }

/* ================= DATA ================= */
let nodes={};

function loadData(){
  treeCol.onSnapshot(snap=>{
    nodes={};
    snap.forEach(d=>nodes[d.id]=d.data());
    calculate();
  });
}

/* ================= WITHDRAWAL (PART-2) ================= */
function loadWithdrawals(){
  withdrawCol.where("status","==","pending").onSnapshot(snap=>{
    withdrawList.innerHTML="";
    snap.forEach(doc=>{
      let d=doc.data();
      withdrawList.innerHTML+=`
      <tr>
        <td>${d.userName}</td>
        <td>‚Çπ${d.amount}</td>
        <td>${d.status}</td>
        <td>
          <button onclick="withdrawCol.doc('${doc.id}').update({status:'approved'})">Approve</button>
          <button onclick="withdrawCol.doc('${doc.id}').update({status:'rejected'})">Reject</button>
        </td>
      </tr>`;
    });
  });
}

/* ================= TRANSFER (PART-3) ================= */
function loadTransfers(){
  transferCol.where("status","==","pending").onSnapshot(snap=>{
    transferList.innerHTML="";
    snap.forEach(doc=>{
      let t=doc.data();
      transferList.innerHTML+=`
      <tr>
        <td>${t.fromName}</td>
        <td>${t.toName}</td>
        <td>‚Çπ${t.amount}</td>
        <td>${t.status}</td>
        <td>
          <button onclick="transferCol.doc('${doc.id}').update({status:'approved'})">Approve</button>
          <button onclick="transferCol.doc('${doc.id}').update({status:'rejected'})">Reject</button>
        </td>
      </tr>`;
    });
  });
}

/* ================= ‡§¨‡§æ‡§ï‡•Ä ‡§Ü‡§™‡§ï‡§æ ‡§™‡•Å‡§∞‡§æ‡§®‡§æ code ‡§µ‡•à‡§∏‡§æ ‡§π‡•Ä ================= */
</script>

</body>
</html>
