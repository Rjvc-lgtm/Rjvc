<!DOCTYPE html><html lang="hi">
<head>
<meta charset="UTF-8">
<title>RJVC Binary Tree Admin (Clean)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:#020617;color:#e5e7eb}
.wrap{max-width:1200px;margin:auto;padding:14px}
h2{margin-top:0}
.small{font-size:13px;color:#94a3b8}
.center{text-align:center}.btn{padding:8px 14px;border-radius:999px;border:none;font-weight:700;cursor:pointer} .btn-primary{background:#2563eb;color:#fff} .btn-secondary{background:#e5e7eb;color:#111827} .btn-danger{background:#dc2626;color:#fff}

.card{background:#0b1320;border-radius:14px;padding:16px}

table{width:100%;border-collapse:collapse;margin-top:12px} th,td{padding:8px;border-bottom:1px solid #1f2937;text-align:center} th{background:#020617}

.action-btn{padding:4px 8px;font-size:12px;border-radius:6px;border:none;cursor:pointer;margin:2px} .btn-tree{background:#2563eb;color:#fff} </style>

</head>
<body><!-- LOGIN --><div id="loginPage" class="wrap">
  <div class="card" style="max-width:400px;margin:60px auto;">
    <h2 class="center">Admin Login</h2>
    <input id="adminId" placeholder="admin" style="width:100%;padding:10px;margin-top:8px">
    <input id="adminPass" type="password" placeholder="1234" style="width:100%;padding:10px;margin-top:8px">
    <button class="btn btn-primary" style="width:100%;margin-top:12px" onclick="login()">Login</button>
    <div id="loginError" class="small" style="color:#f87171;display:none">Wrong login</div>
  </div>
</div><!-- ADMIN --><div id="adminPage" style="display:none"><div class="wrap">
  <h2>Binary Tree Admin</h2>
  <div class="small">Admin yahan se customer manage kar sakta hai</div>
  <button class="btn btn-secondary" onclick="logout()">Logout</button>
</div><div class="wrap">
  <div class="card">
    <h3>Create Root Customer</h3>
    <input id="rootName" placeholder="Name" style="width:100%;padding:8px">
    <input id="rootPass" placeholder="Password" style="width:100%;padding:8px;margin-top:8px">
    <button class="btn btn-primary" style="margin-top:10px" onclick="createRoot()">Add Root</button>
  </div>
</div><div class="wrap">
  <h2>Customer List</h2>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>â‚¹20 Cycles</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="customerTable"></tbody>
  </table>
</div></div><!-- FIREBASE --><script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script><script>
firebase.initializeApp({
  apiKey: "AIzaSyBDw_FQyDzWZLJORFtOwZqrFRfeS5tOFSw",
  authDomain: "rjvc-plan.firebaseapp.com",
  projectId: "rjvc-plan"
});

const db = firebase.firestore();
const treeCol = db.collection("TreeNodes");
let nodes = {};

function login(){
  if(adminId.value==="admin" && adminPass.value==="1234"){
    loginPage.style.display="none";
    adminPage.style.display="block";
    loadData();
  }else loginError.style.display="block";
}
function logout(){location.reload();}

function loadData(){
  treeCol.onSnapshot(snap=>{
    nodes={};
    snap.forEach(d=>nodes[d.id]=Object.assign({id:d.id},d.data()));
    renderTable();
  });
}

function createRoot(){
  if(!rootName.value||!rootPass.value) return alert("Fill both");
  treeCol.add({
    name:rootName.value,
    password:rootPass.value,
    monthsPaid:1,
    parentId:null,leftId:null,rightId:null
  });
  rootName.value="";rootPass.value="";
}

async function addTwentyRupees(id){
  const ref=treeCol.doc(id);
  const snap=await ref.get();
  if(!snap.exists) return;
  const c=snap.data().monthsPaid||0;
  await ref.update({monthsPaid:c+1});
}

function openTreeView(id){
  localStorage.setItem("treeRootId",id);
  window.open("tree.html","_blank");
}

async function deleteCustomerByAdmin_SAFE(id,name){
  if(!confirm(name+" delete?") ) return;
  const snap=await treeCol.doc(id).get();
  if(!snap.exists) return;
  await treeCol.doc(id).delete();
}

function renderTable(){
  customerTable.innerHTML="";
  let i=1;
  Object.values(nodes).forEach(n=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i++}</td>
      <td>${n.name}</td>
      <td>${n.monthsPaid||0} x â‚¹20</td>
      <td>
        <button class="action-btn btn-tree" onclick="openTreeView('${n.id}')">ðŸŒ³ Tree</button>
        <button class="btn btn-primary" onclick="addTwentyRupees('${n.id}')">+â‚¹20</button>
        <button class="btn btn-danger" onclick="deleteCustomerByAdmin_SAFE('${n.id}','${n.name}')">Delete</button>
      </td>`;
    customerTable.appendChild(tr);
  });
}
</script></body>
        </html>
