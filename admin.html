<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <title>RJVC Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    body { background:#f3f6ff; color:#111827; }

    .center-screen{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .card{
      background:white;
      padding:24px 20px;
      border-radius:18px;
      box-shadow:0 15px 40px rgba(15,23,42,.12);
      max-width:420px;
      width:100%;
    }
    h1,h2,h3{ font-weight:700; }
    h1{ font-size:28px; text-align:center; margin-bottom:12px; color:#111827; }
    h2{ font-size:22px; margin-bottom:10px; }
    h3{ font-size:18px; margin-bottom:6px; }

    label{ display:block; font-size:14px; margin-bottom:4px; }
    input{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #d1d5db;
      font-size:15px;
      outline:none;
    }
    input:focus{ border-color:#2563eb; box-shadow:0 0 0 1px #2563eb33; }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 18px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      font-size:15px;
      font-weight:600;
      background:#2563eb;
      color:white;
      transition:.15s;
    }
    .btn:hover{ background:#1d4ed8; }
    .btn-sm{ padding:6px 12px; font-size:13px; }
    .btn-ghost{ background:#e5e7eb; color:#111827; }
    .btn-ghost:hover{ background:#d1d5db; }
    .btn-danger{ background:#ef4444; }
    .btn-danger:hover{ background:#dc2626; }
    .btn-outline{
      background:transparent;
      border:1px solid #d1d5db;
      color:#111827;
    }
    .btn-outline:hover{ background:#e5e7eb; }

    .mt-2{ margin-top:8px; }
    .mt-3{ margin-top:12px; }
    .mt-4{ margin-top:16px; }
    .mb-2{ margin-bottom:8px; }
    .mb-3{ margin-bottom:12px; }
    .text-center{ text-align:center; }
    .text-sm{ font-size:13px; color:#6b7280; }

    .error{ color:#b91c1c; font-size:13px; margin-top:6px; }
    .success{ color:#0f766e; font-size:13px; margin-top:6px; }

    /* Admin layout */
    #adminPage{ display:none; min-height:100vh; }
    .admin-header{
      padding:14px 16px;
      background:#111827;
      color:white;
      display:flex;
      justify-content:space-between;
      align-items:center;
      position:sticky;
      top:0;
      z-index:20;
    }
    .admin-header-title{ font-size:20px; font-weight:700; }
    .admin-header-sub{ font-size:12px; opacity:.8; }

    .admin-container{
      max-width:1100px;
      margin:0 auto;
      padding:16px;
      padding-bottom:80px;
    }

    .wallet-strip{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:16px;
    }
    .wallet-card{
      flex:1 1 220px;
      background:linear-gradient(135deg,#2563eb,#1e40af);
      color:white;
      padding:14px 16px;
      border-radius:16px;
      box-shadow:0 12px 30px rgba(37,99,235,.35);
    }
    .wallet-card.secondary{
      background:linear-gradient(135deg,#16a34a,#15803d);
      box-shadow:0 12px 30px rgba(22,163,74,.35);
    }
    .wallet-label{ font-size:13px; opacity:.85; }
    .wallet-value{ font-size:24px; font-weight:700; margin-top:4px; }
    .wallet-subtext{ font-size:12px; opacity:.9; margin-top:2px; }

    .panel{
      background:white;
      border-radius:16px;
      padding:14px 14px 16px;
      box-shadow:0 10px 24px rgba(15,23,42,.08);
      margin-bottom:18px;
    }
    .panel-header{
      font-size:18px;
      font-weight:700;
      margin-bottom:6px;
    }

    table{ width:100%; border-collapse:collapse; font-size:13px; }
    th,td{ padding:6px 6px; text-align:left; border-bottom:1px solid #e5e7eb; }
    th{ background:#f3f4f6; font-weight:600; white-space:nowrap; }
    tr:last-child td{ border-bottom:none; }

    .badge{
      display:inline-flex;
      padding:2px 8px;
      border-radius:999px;
      font-size:11px;
      font-weight:600;
    }
    .badge-green{ background:#dcfce7; color:#166534; }
    .badge-gray{ background:#e5e7eb; color:#4b5563; }

    .cust-card{ margin-bottom:14px; border-radius:14px; border:1px solid #e5e7eb; overflow:hidden; }

    .cust-main{
      padding:8px 10px;
      background:#f9fafb;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .cust-main-left{ display:flex; flex-direction:column; gap:2px; }
    .cust-main-name{ font-weight:600; }
    .cust-main-id{ font-size:12px; color:#6b7280; }

    .cust-main-wallets{
      font-size:12px;
      color:#374151;
    }
    .cust-main-wallets span{ margin-right:12px; }

    .cust-actions{ display:flex; gap:6px; flex-wrap:wrap; }

    .id-table-wrapper{ padding:6px 8px 10px; background:white; }

    /* Tree view overlay */
    #treeOverlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,.70);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:40;
    }
    #treeCard{
      background:white;
      width:100%;
      max-width:720px;
      max-height:90vh;
      overflow:auto;
      border-radius:20px;
      padding:18px 16px 20px;
      box-shadow:0 18px 45px rgba(15,23,42,.70);
    }

    .tree-node-main,
    .tree-node-sub{
      display:inline-flex;
      min-width:160px;
      justify-content:center;
      align-items:center;
      padding:8px 10px;
      border-radius:999px;
      color:white;
      font-size:13px;
      font-weight:600;
      text-align:center;
    }
    .tree-node-main{ background:#111827; }
    .tree-node-sub{ background:#374151; margin-top:8px; }

    .tree-line{
      height:18px;
      width:2px;
      background:#d1d5db;
      margin:0 auto;
    }
    .tree-row{
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:16px;
      margin-top:10px;
    }

    .tree-meta{
      margin-top:12px;
      font-size:13px;
      color:#374151;
    }
    .tree-meta strong{ font-weight:700; }

    .tree-id-card{
      background:#f9fafb;
      border-radius:12px;
      padding:8px 10px;
      margin-top:10px;
    }
    .tree-id-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:13px;
      margin-bottom:4px;
    }
    .tree-id-actions{
      display:flex;
      gap:6px;
      margin-top:4px;
      flex-wrap:wrap;
    }

    @media (max-width:640px){
      .cust-main{ flex-direction:column; align-items:flex-start; }
      .wallet-strip{ flex-direction:column; }
      .wallet-card{ width:100%; }
    }
  </style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="loginPage" class="center-screen">
  <div class="card">
    <h1>Admin Login</h1>
    <p class="text-sm text-center mb-3">
      कृपया अपना admin ID और password भरें।
    </p>

    <div class="mt-2">
      <label for="adminId">Admin ID</label>
      <input id="adminId" type="text" placeholder="जैसे: admin" />
    </div>

    <div class="mt-2">
      <label for="adminPassword">Password</label>
      <input id="adminPassword" type="password" placeholder="जैसे: 1234" />
    </div>

    <button class="btn mt-3" id="adminLoginBtn" style="width:100%;">
      Login
    </button>
    <div id="loginMsg" class="error" style="display:none;"></div>

    <p class="text-sm mt-3">
      Demo के लिए default login:
      <br>
      <strong>ID:</strong> <code>admin</code> &nbsp;·&nbsp;
      <strong>Password:</strong> <code>1234</code>
    </p>
  </div>
</div>

<!-- ADMIN PAGE -->
<div id="adminPage">
  <header class="admin-header">
    <div>
      <div class="admin-header-title">RJVC ADMIN PANEL</div>
      <div class="admin-header-sub">Main ID + 5 Sub IDs · Binary Pair Earning System</div>
    </div>
    <button class="btn-ghost btn-sm" id="logoutBtn">Logout</button>
  </header>

  <main class="admin-container">

    <!-- Big Wallet Strip -->
    <div class="wallet-strip" id="walletStrip">
      <div class="wallet-card">
        <div class="wallet-label">कुल Commission Wallet (सभी customers)</div>
        <div class="wallet-value" id="totalCommission">₹0</div>
        <div class="wallet-subtext">सिर्फ Main IDs के pairs की earning</div>
      </div>
      <div class="wallet-card secondary">
        <div class="wallet-label">कुल Bonus Wallet (सभी customers)</div>
        <div class="wallet-value" id="totalBonus">₹0</div>
        <div class="wallet-subtext">सभी Sub IDs के pairs की earning</div>
      </div>
    </div>

    <!-- Create Customer Panel -->
    <section class="panel">
      <div class="panel-header">नया Customer Create करें</div>
      <p class="text-sm mb-2">
        यहाँ से नया customer जोड़ें। System अपने आप 1 Main ID + 5 Sub IDs बनाएगा।
      </p>

      <div class="mt-2">
        <label for="custName">Customer Name</label>
        <input id="custName" type="text" placeholder="जैसे: राजेश" />
      </div>

      <div class="mt-2">
        <label for="custPassword">Customer Password</label>
        <input id="custPassword" type="text" placeholder="जैसे: 1234" />
      </div>

      <button class="btn mt-3" onclick="createCustomer()">Create Customer</button>
      <div id="createMsg" class="success" style="display:none;"></div>
    </section>

    <!-- Customer List -->
    <section class="panel">
      <div class="panel-header">Customer List (1 Main + 5 Sub IDs)</div>
      <p class="text-sm mb-2">
        यहाँ से आप customers देख सकते हैं, tree खोल सकते हैं, या delete / block कर सकते हैं।
        हर customer 20 रुपये देता है। हर <strong>2 members (1 pair)</strong> पर
        उसका 15% = <strong>₹3</strong> binary earning auto calculate होती है।
      </p>

      <div id="customerList"></div>

      <div class="mt-3 text-sm">
        <div>कुल Commission Wallet (सभी customers): <strong id="totalCommissionSmall">₹0</strong></div>
        <div>कुल Bonus Wallet (सभी customers): <strong id="totalBonusSmall">₹0</strong></div>
      </div>
    </section>

  </main>
</div>

<!-- TREE OVERLAY -->
<div id="treeOverlay">
  <div id="treeCard">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
      <div>
        <h2 style="font-size:18px;">Customer Tree View</h2>
        <div id="treeTitle" class="text-sm"></div>
      </div>
      <button class="btn-ghost btn-sm" onclick="closeTree()">Close</button>
    </div>

    <div id="treeDiagram" class="mt-3"></div>

    <div id="treeDetail" class="tree-meta"></div>
  </div>
</div>

<script>
  // ======== CONFIG =========
  const ADMIN_ID = "admin";
  const ADMIN_PASSWORD = "1234";
  const STORAGE_KEY = "rjvc_customers_v2";
  const PAIR_AMOUNT = 3; // 20 का 15%

  let customers = [];
  let currentTreeIndex = null;

  // ======== STORAGE HELPERS =========
  function loadCustomers() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      customers = raw ? JSON.parse(raw) : [];
    } catch (e) {
      customers = [];
    }
  }

  function saveCustomers() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(customers));
  }

  // Generate new RJVC main ID
  function generateNewMainId() {
    const num = Math.floor(1000 + Math.random() * 9000);
    return "RJVC" + num;
  }

  // ======== LOGIN LOGIC =========
  document.getElementById("adminLoginBtn").addEventListener("click", () => {
    const id = document.getElementById("adminId").value.trim();
    const pass = document.getElementById("adminPassword").value.trim();
    const msg = document.getElementById("loginMsg");

    if (id === ADMIN_ID && pass === ADMIN_PASSWORD) {
      msg.style.display = "none";
      document.getElementById("loginPage").style.display = "none";
      document.getElementById("adminPage").style.display = "block";
      loadCustomers();
      refreshCustomerTable();
      refreshWalletStrip();
    } else {
      msg.textContent = "गलत ID या Password!";
      msg.style.display = "block";
    }
  });

  document.getElementById("logoutBtn").addEventListener("click", () => {
    document.getElementById("adminId").value = "";
    document.getElementById("adminPassword").value = "";
    document.getElementById("loginPage").style.display = "flex";
    document.getElementById("adminPage").style.display = "none";
  });

  // ======== CUSTOMER CREATION =========
  function createCustomer() {
    const name = document.getElementById("custName").value.trim();
    const password = document.getElementById("custPassword").value.trim();
    const msgEl = document.getElementById("createMsg");

    if (!name || !password) {
      msgEl.style.display = "block";
      msgEl.className = "error";
      msgEl.textContent = "कृपया नाम और password सही से भरें।";
      return;
    }

    const mainId = generateNewMainId();
    const subIds = [
      mainId + "-1",
      mainId + "-2",
      mainId + "-3",
      mainId + "-4",
      mainId + "-5"
    ];

    const newCustomer = {
      mainId,
      name,
      password,
      active: true,
      subIds,
      members: { main: 0, sub1: 0, sub2: 0, sub3: 0, sub4: 0, sub5: 0 },
      commissionWallet: 0,
      bonusWallet: 0
    };

    customers.push(newCustomer);
    saveCustomers();
    refreshCustomerTable();
    refreshWalletStrip();

    msgEl.style.display = "block";
    msgEl.className = "success";
    msgEl.textContent = "Customer सफलतापूर्वक बनाया गया ✔ RJVC ID: " + mainId;

    document.getElementById("custName").value = "";
    document.getElementById("custPassword").value = "";
  }

  // ======== COMMISSION CALCULATION =========
  function recalcEarnings(customer) {
    const m = customer.members;
    const pairsMain = Math.floor(m.main / 2);
    const pairsSub1 = Math.floor(m.sub1 / 2);
    const pairsSub2 = Math.floor(m.sub2 / 2);
    const pairsSub3 = Math.floor(m.sub3 / 2);
    const pairsSub4 = Math.floor(m.sub4 / 2);
    const pairsSub5 = Math.floor(m.sub5 / 2);

    customer.commissionWallet = pairsMain * PAIR_AMOUNT;
    const subTotalPairs = pairsSub1 + pairsSub2 + pairsSub3 + pairsSub4 + pairsSub5;
    customer.bonusWallet = subTotalPairs * PAIR_AMOUNT;

    return {
      pairsMain,
      pairsSub:[pairsSub1,pairsSub2,pairsSub3,pairsSub4,pairsSub5]
    };
  }

  function refreshWalletStrip() {
    let totalCommission = 0;
    let totalBonus = 0;

    customers.forEach(c => {
      recalcEarnings(c);
      totalCommission += c.commissionWallet;
      totalBonus += c.bonusWallet;
    });

    saveCustomers();

    document.getElementById("totalCommission").textContent = "₹" + totalCommission;
    document.getElementById("totalBonus").textContent = "₹" + totalBonus;
    document.getElementById("totalCommissionSmall").textContent = "₹" + totalCommission;
    document.getElementById("totalBonusSmall").textContent = "₹" + totalBonus;
  }

  // ======== RENDER CUSTOMER TABLE =========
  function refreshCustomerTable() {
    const container = document.getElementById("customerList");
    if (!customers.length) {
      container.innerHTML = '<p class="text-sm">अभी कोई customer नहीं है। ऊपर से नया customer create करें।</p>';
      refreshWalletStrip();
      return;
    }

    let html = "";

    customers.forEach((c, index) => {
      const { pairsMain, pairsSub } = recalcEarnings(c);

      const totalMembers =
        c.members.main + c.members.sub1 + c.members.sub2 +
        c.members.sub3 + c.members.sub4 + c.members.sub5;

      html += `
        <div class="cust-card">
          <div class="cust-main">
            <div class="cust-main-left">
              <div class="cust-main-name">${c.name} ${
                c.active ? '<span class="badge badge-green">Active</span>' :
                            '<span class="badge badge-gray">Blocked</span>'
              }</div>
              <div class="cust-main-id">Main ID: <strong>${c.mainId}</strong></div>
              <div class="cust-main-id">Total Members (पूरी tree): <strong>${totalMembers}</strong></div>
            </div>
            <div class="cust-main-wallets">
              <span>Commission: <strong>₹${c.commissionWallet}</strong></span>
              <span>Bonus: <strong>₹${c.bonusWallet}</strong></span>
            </div>
            <div class="cust-actions">
              <button class="btn-outline btn-sm" onclick="openTree(${index})">Tree View</button>
              <button class="btn-ghost btn-sm" onclick="toggleBlock(${index})">
                ${c.active ? "Block" : "Unblock"}
              </button>
              <button class="btn-danger btn-sm" onclick="deleteCustomer(${index})">
                Delete Customer
              </button>
            </div>
          </div>

          <div class="id-table-wrapper">
            <table>
              <thead>
                <tr>
                  <th style="width:90px;">ID Type</th>
                  <th>RJVC ID</th>
                  <th style="width:80px;">Members<br>(This ID)</th>
                  <th style="width:70px;">Pairs</th>
                  <th style="width:160px;">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Main ID</td>
                  <td>${c.mainId}</td>
                  <td>${c.members.main}</td>
                  <td>${pairsMain}</td>
                  <td>
                    <button class="btn-sm btn-outline" onclick="addMember(${index}, 'main')">+ Members (Main)</button>
                  </td>
                </tr>
                <tr>
                  <td>Sub ID 1</td>
                  <td>${c.subIds[0]}</td>
                  <td>${c.members.sub1}</td>
                  <td>${pairsSub[0]}</td>
                  <td>
                    <button class="btn-sm btn-outline" onclick="addMember(${index}, 'sub1')">+ Members (Sub 1)</button>
                  </td>
                </tr>
                <tr>
                  <td>Sub ID 2</td>
                  <td>${c.subIds[1]}</td>
                  <td>${c.members.sub2}</td>
                  <td>${pairsSub[1]}</td>
                  <td>
                    <button class="btn-sm btn-outline" onclick="addMember(${index}, 'sub2')">+ Members (Sub 2)</button>
                  </td>
                </tr>
                <tr>
                  <td>Sub ID 3</td>
                  <td>${c.subIds[2]}</td>
                  <td>${c.members.sub3}</td>
                  <td>${pairsSub[2]}</td>
                  <td>
                    <button class="btn-sm btn-outline" onclick="addMember(${index}, 'sub3')">+ Members (Sub 3)</button>
                  </td>
                </tr>
                <tr>
                  <td>Sub ID 4</td>
                  <td>${c.subIds[3]}</td>
                  <td>${c.members.sub4}</td>
                  <td>${pairsSub[3]}</td>
                  <td>
                    <button class="btn-sm btn-outline" onclick="addMember(${index}, 'sub4')">+ Members (Sub 4)</button>
                  </td>
                </tr>
                <tr>
                  <td>Sub ID 5</td>
                  <td>${c.subIds[4]}</td>
                  <td>${c.members.sub5}</td>
                  <td>${pairsSub[4]}</td>
                  <td>
                    <button class="btn-sm btn-outline" onclick="addMember(${index}, 'sub5')">+ Members (Sub 5)</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      `;
    });

    container.innerHTML = html;
    refreshWalletStrip();
  }

  // ======== ACTIONS: MEMBERS / BLOCK / DELETE =========
  function addMember(index, idKey) {
    const c = customers[index];
    if (!c.active) {
      alert("यह customer blocked है, पहले unblock करें।");
      return;
    }

    const current = c.members[idKey];
    const extra = prompt("इस ID पर कितने नये members जोड़ने हैं? (जैसे: 1,2,5)", "1");
    if (extra === null) return;
    const num = parseInt(extra, 10);
    if (isNaN(num) || num <= 0) {
      alert("कृपया सही number लिखें।");
      return;
    }

    c.members[idKey] = current + num;
    saveCustomers();
    refreshCustomerTable();
  }

  function toggleBlock(index) {
    const c = customers[index];
    c.active = !c.active;
    saveCustomers();
    refreshCustomerTable();
  }

  function deleteCustomer(index) {
    if (!confirm("पूरा customer (Main + सभी Sub IDs) delete करना है?")) return;
    customers.splice(index, 1);
    saveCustomers();
    refreshCustomerTable();
  }

  // ======== TREE VIEW =========
  function openTree(index) {
    currentTreeIndex = index;
    const c = customers[index];
    const { pairsMain, pairsSub } = recalcEarnings(c);

    document.getElementById("treeTitle").textContent =
      c.name + " (" + c.mainId + ") की IDs का Tree – 1 Main + 5 Sub IDs";

    // Tree diagram (simple vertical layout)
    const treeHtml = `
      <div class="tree-row">
        <div>
          <div class="tree-node-main">
            Main ID<br>${c.mainId}
          </div>
          <div class="tree-line"></div>
          <div class="tree-row">
            <div>
              <div class="tree-node-sub">
                Sub ID 1<br>${c.subIds[0]}
              </div>
            </div>
            <div>
              <div class="tree-node-sub">
                Sub ID 2<br>${c.subIds[1]}
              </div>
            </div>
          </div>
          <div class="tree-row">
            <div>
              <div class="tree-node-sub">
                Sub ID 3<br>${c.subIds[2]}
              </div>
            </div>
            <div>
              <div class="tree-node-sub">
                Sub ID 4<br>${c.subIds[3]}
              </div>
            </div>
          </div>
          <div class="tree-row">
            <div>
              <div class="tree-node-sub">
                Sub ID 5<br>${c.subIds[4]}
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
    document.getElementById("treeDiagram").innerHTML = treeHtml;

    const totalMembers =
      c.members.main + c.members.sub1 + c.members.sub2 +
      c.members.sub3 + c.members.sub4 + c.members.sub5;

    const metaHtml = `
      <div class="tree-id-card">
        <div class="tree-id-header">
          <span><strong>Main ID:</strong> ${c.mainId}</span>
          <span>Members: ${c.members.main} · Pairs: ${pairsMain}</span>
        </div>
        <div class="tree-id-actions">
          <button class="btn-sm btn-outline" onclick="addMember(${index}, 'main')">+ Members (Main)</button>
        </div>
      </div>

      <div class="tree-id-card">
        <div class="tree-id-header">
          <span><strong>Sub ID 1:</strong> ${c.subIds[0]}</span>
          <span>Members: ${c.members.sub1} · Pairs: ${pairsSub[0]}</span>
        </div>
        <div class="tree-id-actions">
          <button class="btn-sm btn-outline" onclick="addMember(${index}, 'sub1')">+ Members (Sub 1)</button>
        </div>
      </div>

      <div class="tree-id-card">
        <div class="tree-id-header">
          <span><strong>Sub ID 2:</strong> ${c.subIds[1]}</span>
          <span>Members: ${c.members.sub2} · Pairs: ${pairsSub[1]}</span>
        </div>
        <div class="tree-id-actions">
          <button class="btn-sm btn-outline" onclick="addMember(${index}, 'sub2')">+ Members (Sub 2)</button>
        </div>
      </div>

      <div class="tree-id-card">
        <div class="tree-id-header">
          <span><strong>Sub ID 3:</strong> ${c.subIds[2]}</span>
          <span>Members: ${c.members.sub3} · Pairs: ${pairsSub[2]}</span>
        </div>
        <div class="tree-id-actions">
          <button class="btn-sm btn-outline" onclick="addMember(${index}, 'sub3')">+ Members (Sub 3)</button>
        </div>
      </div>

      <div class="tree-id-card">
        <div class="tree-id-header">
          <span><strong>Sub ID 4:</strong> ${c.subIds[3]}</span>
          <span>Members: ${c.members.sub4} · Pairs: ${pairsSub[3]}</span>
        </div>
        <div class="tree-id-actions">
          <button class="btn-sm btn-outline" onclick="addMember(${index}, 'sub4')">+ Members (Sub 4)</button>
        </div>
      </div>

      <div class="tree-id-card">
        <div class="tree-id-header">
          <span><strong>Sub ID 5:</strong> ${c.subIds[4]}</span>
          <span>Members: ${c.members.sub5} · Pairs: ${pairsSub[4]}</span>
        </div>
        <div class="tree-id-actions">
          <button class="btn-sm btn-outline" onclick="addMember(${index}, 'sub5')">+ Members (Sub 5)</button>
        </div>
      </div>

      <p class="mt-3">
        कुल members (पूरी tree): <strong>${totalMembers}</strong><br>
        Main ID Commission Wallet: <strong>₹${c.commissionWallet}</strong><br>
        सब Sub IDs से बनने वाली total pairs की earning सिर्फ Main ID के Bonus Wallet में जाती है –
        अभी Bonus Wallet: <strong>₹${c.bonusWallet}</strong>
      </p>

      <div class="tree-id-actions" style="margin-top:10px;">
        <button class="btn-ghost btn-sm" onclick="toggleBlock(${index})">
          ${c.active ? "Block Customer" : "Unblock Customer"}
        </button>
        <button class="btn-danger btn-sm" onclick="deleteCustomer(${index}); closeTree();">
          Delete Customer
        </button>
      </div>
    `;

    document.getElementById("treeDetail").innerHTML = metaHtml;

    document.getElementById("treeOverlay").style.display = "flex";
  }

  function closeTree() {
    document.getElementById("treeOverlay").style.display = "none";
    currentTreeIndex = null;
    refreshCustomerTable();
  }
</script>
</body>
</html>
