<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <title>RJVC Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 16px;
      background: #e6ebff;
    }
    .app {
      max-width: 960px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 20px;
      padding: 18px 18px 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    }

    h1 {
      text-align: center;
      font-size: 26px;
      margin: 6px 0 4px;
      color: #102a6b;
    }
    h1 span {
      display: block;
      font-size: 13px;
      color: #4e5ba6;
      margin-top: 2px;
    }
    h2 {
      font-size: 18px;
      margin: 12px 0 4px;
      color: #102a6b;
    }
    .subtitle {
      font-size: 12px;
      color: #555;
      margin-bottom: 10px;
    }

    label {
      font-size: 13px;
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
    }
    input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 13px;
    }
    button {
      border: none;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      cursor: pointer;
    }
    .btn-primary {
      background: #0066ff;
      color: #fff;
    }
    .btn-secondary {
      background: #e0e4ff;
      color: #102a6b;
    }
    .btn-danger {
      background: #ffe1e1;
      color: #b00020;
    }
    .btn-small {
      font-size: 11px;
      padding: 5px 10px;
      margin: 2px 0;
      width: 100%;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    .col {
      flex: 1 1 180px;
    }

    .section-card {
      margin-top: 14px;
      padding: 10px 10px 12px;
      border-radius: 14px;
      background: #f9f9ff;
      border: 1px solid #dde2ff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    th, td {
      padding: 6px 6px;
      border-bottom: 1px solid #eef1ff;
      text-align: left;
      vertical-align: top;
    }
    th {
      background: #eef1ff;
      font-weight: 700;
      color: #102a6b;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
    }
    .badge-active {
      background: #e3f5ff;
      color: #095c92;
    }
    .badge-blocked {
      background: #ffe1e1;
      color: #b00020;
    }

    .ok-msg {
      font-size: 12px;
      color: #0a7a25;
      margin-top: 4px;
    }

    /* Tree View */
    .tree-wrapper {
      margin-top: 8px;
      padding: 10px;
      border-radius: 14px;
      background: #f5f7ff;
      border: 1px dashed #c9cffc;
    }
    .tree-title {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #222;
    }
    .tree {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      font-size: 11px;
    }
    .tree-level {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 40px;
    }
    .tree-node {
      background: #111827;
      color: #f9fafb;
      padding: 6px 12px;
      border-radius: 999px;
      min-width: 110px;
      text-align: center;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
    }
    .tree-node.main {
      background: #111827;
    }
    .tree-node.sub {
      background: #1f2937;
    }
    .tree-connector {
      width: 150px;
      height: 20px;
      border-bottom: 2px solid #9ca3af;
      border-left: 2px solid #9ca3af;
      border-right: 2px solid #9ca3af;
      margin-top: -8px;
    }
    .tree-connector.sub1-sub3 {
      width: 80px;
    }
    .tree-empty {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
    }

    .small-text {
      font-size: 11px;
      color: #555;
    }
    .scroll-box {
      max-height: 320px;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid #e1e4ff;
      margin-top: 6px;
      background: #fff;
    }

    .withdraw-card {
      margin-top: 10px;
      padding: 8px;
      border-radius: 12px;
      background: #fff9f0;
      border: 1px solid #ffe0b3;
      font-size: 12px;
    }
    .pill {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 10px;
    }
    .pill-commission { background:#e0f2ff; color:#055160; }
    .pill-bonus { background:#fce7f3; color:#9d174d; }
    .pill-pending { background:#fff7e0; color:#8a6d1d; }
    .pill-paid { background:#e7f6e7; color:#1f5d27; }
    .pill-rejected { background:#ffe4e6; color:#9f1239; }
  </style>
</head>
<body>
  <div class="app">
    <h1>
      RJVC ADMIN PANEL
      <span>Auto Tree ‚Ä¢ Commission ‚Ä¢ Bonus ‚Ä¢ Level Congrats</span>
    </h1>

    <!-- NEW CUSTOMER CREATE -->
    <div class="section-card">
      <h2>‡§®‡§Ø‡§æ Customer Create ‡§ï‡§∞‡•á‡§Ç</h2>
      <div class="subtitle">
        ‡§Ø‡§π‡§æ‡§Å ‡§∏‡•á ‡§®‡§Ø‡§æ customer ‡§¨‡§®‡§æ‡§®‡•á ‡§™‡§∞ 1 Main ID ‡§î‡§∞ 3 Sub ID ‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ ‡§¨‡§®‡•á‡§Ç‡§ó‡•á  
        ‡§î‡§∞ ‡§™‡•Ç‡§∞‡§æ data localStorage ‡§Æ‡•á‡§Ç auto save ‡§π‡•ã‡§ó‡§æ‡•§
      </div>

      <div class="row">
        <div class="col">
          <label>Customer Name</label>
          <input id="newName" type="text" placeholder="‡§ú‡•à‡§∏‡•á: ‡§∞‡§Æ‡•á‡§∂" />
        </div>
        <div class="col">
          <label>Mobile Number</label>
          <input id="newMobile" type="tel" placeholder="10 digit number" />
        </div>
      </div>
      <button class="btn-primary" onclick="createCustomer()">Create Customer</button>
      <div id="createMsg" class="ok-msg"></div>
    </div>

    <!-- CUSTOMER LIST -->
    <div class="section-card">
      <h2>Customer List (1 Main + 3 Sub IDs)</h2>
      <div class="subtitle">
        ‡§Ø‡§π‡§æ‡§Å ‡§∏‡•á ‡§Ü‡§™ Member add ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, Commission / Bonus ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç  
        ‡§î‡§∞ Tree View ‡§∏‡§ø‡§∞‡•ç‡§´ admin ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•à (customer ‡§ï‡•ã ‡§®‡§π‡•Ä‡§Ç ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ)‡•§
      </div>

      <div class="scroll-box">
        <table id="customerTable">
          <thead>
            <tr>
              <th>ID Type</th>
              <th>RJVC ID</th>
              <th>Name</th>
              <th>Mobile</th>
              <th>Joined Members (This ID)</th>
              <th>Commission Wallet</th>
              <th>Bonus Wallet</th>
              <th>Status / Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- JS ‡§∏‡•á rows -->
          </tbody>
        </table>
      </div>

      <!-- TREE VIEW -->
      <div id="treeContainer" class="tree-wrapper" style="display:none;">
        <div class="tree-title">Tree View (‡§ï‡•á‡§µ‡§≤ Admin ‡§ï‡•á ‡§≤‡§ø‡§è)</div>
        <div id="treeContent"></div>
        <div class="small-text">
          Main ID ‡§π‡§Æ‡•á‡§∂‡§æ ‡§∏‡§¨‡§∏‡•á ‡§ä‡§™‡§∞ ‡§∞‡§π‡•á‡§ó‡§æ‡•§ ‡§â‡§∏‡§ï‡•á ‡§®‡•Ä‡§ö‡•á Sub ID 1 ‡§î‡§∞ Sub ID 2 ‡§π‡•ã‡§Ç‡§ó‡•á,  
          ‡§î‡§∞ Sub ID 1 ‡§ï‡•á ‡§®‡•Ä‡§ö‡•á Sub ID 3 ‡§∞‡§π‡•á‡§ó‡§æ (‡§†‡•Ä‡§ï ‡§µ‡•à‡§∏‡•á ‡§π‡•Ä ‡§ú‡•à‡§∏‡•á ‡§Ü‡§™‡§®‡•á drawing ‡§≠‡•á‡§ú‡•Ä ‡§•‡•Ä)‡•§
        </div>
      </div>
    </div>

    <!-- WITHDRAWAL REQUESTS -->
    <div class="section-card">
      <h2>Withdrawal Requests (Approve / Reject)</h2>
      <div class="subtitle">
        Customer side ‡§∏‡•á ‡§ú‡§¨ ‡§≠‡•Ä withdrawal request ‡§Ü‡§§‡•Ä ‡§π‡•à, ‡§µ‡§π ‡§Ø‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡•á‡§ó‡•Ä‡•§  
        Commission / Bonus ‡§¶‡•ã‡§®‡•ã‡§Ç wallet ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§≤‡§ó-‡§Ö‡§≤‡§ó source ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ‡•§
      </div>

      <div class="scroll-box">
        <table id="withdrawTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Mobile</th>
              <th>Amount</th>
              <th>Wallet</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <!-- JS ‡§∏‡•á rows -->
          </tbody>
        </table>
      </div>

      <div class="withdraw-card">
        <div><b>Rule:</b></div>
        <div>
          - Commission Wallet ‚Üí direct earning, mobile-to-mobile transfer allowed (customer side).<br/>
          - Bonus Wallet ‚Üí ‡§∏‡§ø‡§∞‡•ç‡§´ withdrawal ‡§ï‡•á ‡§≤‡§ø‡§è‡•§ Sub IDs ‡§ï‡•Ä ‡§∏‡§æ‡§∞‡•Ä earning ‡§Æ‡•á‡§Ç ‡§∏‡•á 15% company share ‡§ï‡§ü‡§ï‡§∞  
          ‡§¨‡§ö‡§æ 85% Main ID ‡§ï‡•á Bonus Wallet ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§<br/>
          - Withdrawal request ‡§Ü‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§π‡•Ä amount wallet ‡§∏‡•á minus ‡§π‡•ã ‡§ö‡•Å‡§ï‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à,  
          ‡§á‡§∏‡§≤‡§ø‡§è <b>Reject</b> ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§π‡§Æ ‡§µ‡§π‡•Ä amount ‡§µ‡§æ‡§™‡§∏ ‡§â‡§∏‡•Ä wallet ‡§Æ‡•á‡§Ç add ‡§ï‡§∞ ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Helpers ----------
    function formatNumber(n) {
      return Number(n || 0).toLocaleString("en-IN");
    }

    function loadSettings() {
      try {
        const s = JSON.parse(localStorage.getItem("rjvc_settings") || "{}");
        return {
          perMember: s.perMember || 16,
          startMembers: s.startMembers || 2,
          multiplier: s.multiplier || 2
        };
      } catch (e) {
        return { perMember: 16, startMembers: 2, multiplier: 2 };
      }
    }

    function getCustomers() {
      try {
        const arr = JSON.parse(localStorage.getItem("rjvc_customers") || "[]");
        return Array.isArray(arr) ? arr : [];
      } catch (e) {
        return [];
      }
    }

    function saveCustomers(list) {
      localStorage.setItem("rjvc_customers", JSON.stringify(list));
    }

    function getWithdrawals() {
      try {
        const arr = JSON.parse(localStorage.getItem("rjvc_withdrawals") || "[]");
        return Array.isArray(arr) ? arr : [];
      } catch (e) {
        return [];
      }
    }

    function saveWithdrawals(list) {
      localStorage.setItem("rjvc_withdrawals", JSON.stringify(list));
    }

    function ensureTree(customer) {
      if (!customer.tree) {
        customer.tree = {
          main: { members: 0, level: 0 },
          sub1: { members: 0, level: 0 },
          sub2: { members: 0, level: 0 },
          sub3: { members: 0, level: 0 }
        };
      } else {
        // default fields if missing
        ["main","sub1","sub2","sub3"].forEach(k=>{
          if (!customer.tree[k]) {
            customer.tree[k] = { members: 0, level: 0 };
          } else {
            if (typeof customer.tree[k].members !== "number") customer.tree[k].members = 0;
            if (typeof customer.tree[k].level !== "number") customer.tree[k].level = 0;
          }
        });
      }
      if (typeof customer.bonusBalance !== "number") customer.bonusBalance = 0;
      if (typeof customer.walletBalance !== "number") customer.walletBalance = 0;
      if (typeof customer.joinedMembers !== "number") customer.joinedMembers = 0;
      if (!customer.status) customer.status = "Active";
    }

    function generateRJVCId(existing) {
      // simple random number not used before
      let id;
      while (true) {
        const num = Math.floor(1000 + Math.random() * 9000);
        id = "RJVC" + num;
        if (!existing.some(c => c.mainId === id)) break;
      }
      return id;
    }

    // ---------- Create Customer ----------
    function createCustomer() {
      const name = (document.getElementById("newName").value || "").trim();
      const mobile = (document.getElementById("newMobile").value || "").trim();
      const msgBox = document.getElementById("createMsg");
      msgBox.innerText = "";

      if (!name || !mobile || mobile.length < 10) {
        alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä ‡§®‡§æ‡§Æ ‡§î‡§∞ 10 digit ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§≠‡§∞‡•á‡§Ç‡•§");
        return;
      }

      const customers = getCustomers();
      if (customers.some(c => c.mobile === mobile)) {
        alert("‡§Ø‡§π ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§π‡§≤‡•á ‡§∏‡•á register ‡§π‡•à‡•§");
        return;
      }

      const mainId = generateRJVCId(customers);

      const record = {
        id: Date.now(),
        name,
        mobile,
        joinedMembers: 0,
        state: "adminCreated",
        currentLevel: 0,
        nextLevel: null,
        remainingForNext: 0,
        nextLevelIncome: 0,
        totalIncome: 0,
        walletBalance: 0,
        bonusBalance: 0,
        mainId,
        sub1Id: mainId + "-1",
        sub2Id: mainId + "-2",
        sub3Id: mainId + "-3",
        status: "Active",
        tree: {
          main: { members: 0, level: 0 },
          sub1: { members: 0, level: 0 },
          sub2: { members: 0, level: 0 },
          sub3: { members: 0, level: 0 }
        },
        createdAt: new Date().toISOString()
      };

      customers.push(record);
      saveCustomers(customers);

      document.getElementById("newName").value = "";
      document.getElementById("newMobile").value = "";

      msgBox.innerText = "Customer ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‚úî (Main + 3 Sub IDs auto ‡§¨‡§® ‡§ö‡•Å‡§ï‡•á ‡§π‡•à‡§Ç)";
      renderCustomers();
    }

    // ---------- Commission + Members + Levels ----------
    function addMember(customerId, nodeKey) {
      const settings = loadSettings();
      const customers = getCustomers();
      const idx = customers.findIndex(c => c.id === customerId);
      if (idx === -1) return;

      const c = customers[idx];
      ensureTree(c);

      if (c.status === "Blocked") {
        alert("‡§Ø‡§π customer Blocked ‡§π‡•à, ‡§™‡§π‡§≤‡•á Active ‡§ï‡§∞‡•á‡§Ç‡•§");
        return;
      }

      const node = c.tree[nodeKey];
      if (!node) return;

      node.members += 1;
      c.joinedMembers = (c.joinedMembers || 0) + 1;

      // Commission logic
      if (nodeKey === "main") {
        c.walletBalance = (c.walletBalance || 0) + settings.perMember;
      } else {
        const gross = settings.perMember;
        const companyShare = Math.round(gross * 0.15); // 15% rounded
        const bonus = gross - companyShare;
        c.bonusBalance = (c.bonusBalance || 0) + bonus;
      }

      // Level check per node
      checkAndCongrats(c, nodeKey, node, settings);

      customers[idx] = c;
      saveCustomers(customers);
      renderCustomers();
    }

    function checkAndCongrats(customer, nodeKey, node, settings) {
      const { startMembers, multiplier } = settings;
      const idLabel =
        nodeKey === "main"
          ? "Main ID (" + customer.mainId + ")"
          : nodeKey === "sub1"
          ? "Sub ID 1 (" + customer.sub1Id + ")"
          : nodeKey === "sub2"
          ? "Sub ID 2 (" + customer.sub2Id + ")"
          : "Sub ID 3 (" + customer.sub3Id + ")";

      const nextLevel = node.level + 1;
      const requiredForNext = startMembers * Math.pow(multiplier, nextLevel - 1);

      if (node.members >= requiredForNext) {
        node.level = nextLevel;
        alert("Congratulations! " + idLabel + " ‡§®‡•á Level " + nextLevel + " ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞ ‡§≤‡§ø‡§Ø‡§æ ‡§π‡•à üéâ");
      }
    }

    function toggleStatus(customerId) {
      const customers = getCustomers();
      const idx = customers.findIndex(c => c.id === customerId);
      if (idx === -1) return;
      const c = customers[idx];
      c.status = c.status === "Active" ? "Blocked" : "Active";
      customers[idx] = c;
      saveCustomers(customers);
      renderCustomers();
    }

    // ---------- Tree View ----------
    function showTree(customerId) {
      const customers = getCustomers();
      const c = customers.find(x => x.id === customerId);
      if (!c) return;
      ensureTree(c);

      const cont = document.getElementById("treeContent");
      const wrapper = document.getElementById("treeContainer");
      wrapper.style.display = "block";

      const main = c.mainId;
      const sub1 = c.sub1Id;
      const sub2 = c.sub2Id;
      const sub3 = c.sub3Id;

      cont.innerHTML = `
        <div class="tree">
          <div class="tree-level">
            <div class="tree-node main">
              Main ID<br>${main}
            </div>
          </div>
          <div class="tree-connector"></div>
          <div class="tree-level">
            <div class="tree-node sub">
              Sub ID 1<br>${sub1}
            </div>
            <div class="tree-node sub">
              Sub ID 2<br>${sub2}
            </div>
          </div>
          <div class="tree-connector sub1-sub3"></div>
          <div class="tree-level">
            <div class="tree-node sub">
              Sub ID 3<br>${sub3}
            </div>
          </div>
          <div class="tree-empty">
            (‡§Ö‡§≠‡•Ä Sub ID 2 ‡§ï‡•á ‡§®‡•Ä‡§ö‡•á future ‡§Æ‡•á‡§Ç ‡§®‡§è customers join ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç,
             structure ‡§Ü‡§™‡§ï‡•á drawing ‡§ú‡•à‡§∏‡§æ ‡§π‡•Ä ‡§∞‡§π‡•á‡§ó‡§æ)
          </div>
        </div>
      `;
    }

    // ---------- Render Customers ----------
    function renderCustomers() {
      const tbody = document.querySelector("#customerTable tbody");
      tbody.innerHTML = "";
      const customers = getCustomers();
      customers.forEach(c => {
        ensureTree(c);
        const totalMembersMain = c.tree.main.members;
        const totalMembersSub1 = c.tree.sub1.members;
        const totalMembersSub2 = c.tree.sub2.members;
        const totalMembersSub3 = c.tree.sub3.members;

        const rowsHtml = [];

        function row(idType, rjvcId, nodeKey, members) {
          const isMain = nodeKey === "main";
          rowsHtml.push(`
            <tr>
              <td>${idType}</td>
              <td>${rjvcId}</td>
              <td>${c.name}</td>
              <td>${c.mobile}</td>
              <td>${formatNumber(members)}</td>
              <td>${isMain ? "‚Çπ" + formatNumber(c.walletBalance || 0) : "‚Äî"}</td>
              <td>${isMain ? "‚Çπ" + formatNumber(c.bonusBalance || 0) : "‚Äî"}</td>
              <td>
                ${isMain
                  ? `<span class="badge ${c.status === "Active" ? "badge-active" : "badge-blocked"}">
                       ${c.status}
                     </span><br/>`
                  : ""}
                <button class="btn-secondary btn-small" onclick="addMember(${c.id}, '${nodeKey}')">
                  + Member (${idType})
                </button><br/>
                ${isMain ? `
                  <button class="btn-secondary btn-small" onclick="showTree(${c.id})">
                    Tree View
                  </button><br/>
                  <button class="btn-small ${c.status === "Active" ? "btn-danger" : "btn-secondary"}"
                          onclick="toggleStatus(${c.id})">
                    ${c.status === "Active" ? "Block" : "Unblock"}
                  </button>
                ` : ""}
              </td>
            </tr>
          `);
        }

        row("Main ID", c.mainId, "main", totalMembersMain);
        row("Sub ID 1", c.sub1Id, "sub1", totalMembersSub1);
        row("Sub ID 2", c.sub2Id, "sub2", totalMembersSub2);
        row("Sub ID 3", c.sub3Id, "sub3", totalMembersSub3);

        tbody.innerHTML += rowsHtml.join("");
      });

      renderWithdrawals();
    }

    // ---------- Withdrawals ----------
    function renderWithdrawals() {
      const tbody = document.querySelector("#withdrawTable tbody");
      tbody.innerHTML = "";
      const list = getWithdrawals();
      const customers = getCustomers();

      list
        .slice()
        .sort((a,b)=> new Date(b.createdAt || 0) - new Date(a.createdAt || 0))
        .forEach(w => {
          const cust = customers.find(c => c.id === w.customerId) || {};
          const source = w.source || "commission";
          const walletPill =
            source === "bonus"
              ? '<span class="pill pill-bonus">Bonus Wallet</span>'
              : '<span class="pill pill-commission">Commission Wallet</span>';

          let statusPill = "";
          if (w.status === "Paid") {
            statusPill = '<span class="pill pill-paid">Paid</span>';
          } else if (w.status === "Rejected") {
            statusPill = '<span class="pill pill-rejected">Rejected</span>';
          } else {
            statusPill = '<span class="pill pill-pending">Pending</span>';
          }

          const canAction = w.status === "Pending";

          tbody.innerHTML += `
            <tr>
              <td>${w.name || cust.name || "-"}</td>
              <td>${w.mobile || cust.mobile || "-"}</td>
              <td>‚Çπ${formatNumber(w.amount || 0)}</td>
              <td>${walletPill}</td>
              <td>${statusPill}</td>
              <td>
                ${canAction ? `
                  <button class="btn-secondary btn-small"
                          onclick="approveWithdrawal(${w.id})">Approve</button><br/>
                  <button class="btn-danger btn-small"
                          onclick="rejectWithdrawal(${w.id})">Reject</button>
                ` : "‚Äî"}
              </td>
            </tr>
          `;
        });
    }

    function approveWithdrawal(id) {
      const list = getWithdrawals();
      const idx = list.findIndex(w => w.id === id);
      if (idx === -1) return;
      if (!confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ withdrawal request ‡§ï‡•ã Approved ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) return;
      list[idx].status = "Paid";
      saveWithdrawals(list);
      renderWithdrawals();
      alert("Withdrawal request Approved ‡§ï‡§∞ ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à‡•§");
    }

    function rejectWithdrawal(id) {
      const list = getWithdrawals();
      const idx = list.findIndex(w => w.id === id);
      if (idx === -1) return;
      const w = list[idx];
      if (!confirm("Reject ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ amount ‡§µ‡§æ‡§™‡§∏ wallet ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§ ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç?")) return;

      const customers = getCustomers();
      const cIdx = customers.findIndex(c => c.id === w.customerId);
      if (cIdx !== -1) {
        const c = customers[cIdx];
        const amt = Number(w.amount || 0);
        if (w.source === "bonus") {
          c.bonusBalance = (c.bonusBalance || 0) + amt;
        } else {
          c.walletBalance = (c.walletBalance || 0) + amt;
        }
        customers[cIdx] = c;
        saveCustomers(customers);
      }

      list[idx].status = "Rejected";
      saveWithdrawals(list);
      renderCustomers();
      alert("Withdrawal request Rejected ‡§ï‡•Ä ‡§ó‡§à ‡§î‡§∞ amount ‡§µ‡§æ‡§™‡§∏ wallet ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§");
    }

    // ---------- Init ----------
    window.addEventListener("load", function () {
      renderCustomers();
    });
  </script>
</body>
</html>
